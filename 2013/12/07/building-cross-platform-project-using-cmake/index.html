<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Building Cross-platform Project Using CMake | Nightfade's Techlog</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/pure-min.css"><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Building Cross-platform Project Using CMake</h1><a id="logo" href="/.">Nightfade's Techlog</a><p class="description">Programming</p></div><div id="nav-menu"><a href="/." class="current"><i class="icon-home"> 首页</i></a><a href="/archives/"><i class="icon-archive"> 归档</i></a><a href="/about/"><i class="icon-about"> 关于</i></a><a href="/atom.xml"><i class="icon-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post post-page"><h1 class="post-title">Building Cross-platform Project Using CMake</h1><div class="post-meta">Dec 7 2013 | </div><span data-disqus-identifier="2013/12/07/building-cross-platform-project-using-cmake/" class="disqus-comment-count"></span><div class="post-content"><h2 id="Why_CMake"><a href="#Why_CMake" class="headerlink" title="Why CMake"></a>Why CMake</h2><p>第一次在使用CMake作为项目的构建工具还是在实验室写Structure from Motion系统的时候。一方面是因为要求程序可以在Windows和Linux下都能够编译，另外一个重要原因还是因为实在厌倦了不断的手工去改VS工程文件的各种选项。</p>
<p>在此之前，在有道的做OCR系统的时候也使用过SCons。当时主要考虑的还是因为SCons是使用Python作为脚本，不需要额外的再去学习一门语言。如果项目仅仅需要在Linux下进行编译，那么SCons是一个不错的选择。但是在跨平台方面，和CMake差距还是比较大的。而目前使用CMake的大型项目也有很多，足够证明CMake的可用性：KDE、MySQL、Second Life、OpenCV等。</p>
<p>列举一下CMake的众多优点：</p>
<ol>
<li>仅仅需要一套Build文本配置文件（CMakeLists.txt），就可以在所有平台进行项目构建。不再需要为每一个平台都维护一份项目文件。</li>
<li>可以根据CMakeLists直接生成Native的项目文件（Visual Studio、XCode、CodeBlocks、Makefile、Eclipse、KDevelop等）。这就意味着我们在享有使用纯文本配置项目构建的便利同时还可以继续使用IDE来编写代码。对于iOS等必须通过XCode对程序进行签名才能完成构建的项目，更是巨大的便利。</li>
<li>自动推断源代码文件之间的依赖关系，并且在大多数平台上支持并行编译。</li>
<li>具有编译时的配置的能力，对于有众多可选组件的项目来说，可以很容易的让用户配置自己所需的组件。</li>
<li>具有众多内置的功能，诸如自动搜索系统中已经安装的依赖库、头文件，自动检测平台特性等。</li>
<li>可以在source tree以外进行项目的构建，始终保持source tree的干净。对于有代码洁癖的coder来说，这一点也同样至关重要。</li>
</ol>
<h2 id="Building_Project_Using_CMake"><a href="#Building_Project_Using_CMake" class="headerlink" title="Building Project Using CMake"></a>Building Project Using CMake</h2><p>以下内容大多参考《Mastering CMake》，以尽可能短的篇幅说明如何编写CMake脚本文件。CMake的安装和执行就不再赘述，可参看官方说明<a href="http://www.cmake.org/cmake/help/install.html" target="_blank" rel="external">Installing CMake</a>以及<a href="http://www.cmake.org/cmake/help/runningcmake.html" target="_blank" rel="external">Running CMake</a>。</p>
<h3 id="Basic_CMake_Usage_and_Syntax"><a href="#Basic_CMake_Usage_and_Syntax" class="headerlink" title="Basic CMake Usage and Syntax"></a>Basic CMake Usage and Syntax</h3><p>类似于传统的Makefile，CMake使用项目目录下的一个或多个CMakeLists文件来控制构建过程。CMakeLists文件包含了控制构建过程的一系列命令，这些命令具有以下形式：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">command (args...)</span><br></pre></td></tr></table></figure>
<p>command是命令的名称，args是空格分隔的参数列表。CMake对命令名字大小写不敏感。</p>
<p>一个虽然简短但是包含了诸如平台相关源码、搜索依赖库以及链接的CMakeLists样例如下：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">cmake_minimum_required</span> (<span class="number">2.8</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">project</span>(HELLO)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> (HELLO_SRCS Hello.c File2.c File3.c)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (WIN32)</span><br><span class="line">    <span class="keyword">set</span> (HELLO_SRCS <span class="envvar">$&#123;HELLO_SRCS&#125;</span> WinSupport.c)</span><br><span class="line"><span class="keyword">else</span> ()</span><br><span class="line">    <span class="keyword">set</span> (HELLO_SRCS <span class="envvar">$&#123;HELLO_SRCS&#125;</span> UnixSupport.c)</span><br><span class="line"><span class="keyword">endif</span> ()</span><br><span class="line"></span><br><span class="line"><span class="comment"># look for the Tcl library</span></span><br><span class="line"><span class="keyword">find_library</span> (TCL_LIBRARY</span><br><span class="line">    NAMES tcl tcl84 tcl83 tcl82 tcl80</span><br><span class="line">    PATHS /usr/lib /usr/local/lib</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (TCL_LIBRARY)</span><br><span class="line">    target_link_library (Hello <span class="envvar">$&#123;TCL_LIBRARY&#125;</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>
<p>CMake中各单位的基本关系：</p>
<ol>
<li>若干源码文件构成一个<code>target</code>，一个<code>target</code>通常是一个可执行文件或库。</li>
<li>一个directory表示source tree中包含一个CMakeLists文件的目录，并且有一个或多个target与之关联。</li>
<li>每个目录有一个local generator负责生成这个目录下的Makefile或者工程文件。</li>
</ol>
<h4 id="u57FA_u672C_u7684COMMAND"><a href="#u57FA_u672C_u7684COMMAND" class="headerlink" title="基本的COMMAND"></a>基本的COMMAND</h4><p>0. 在CMakeLists.txt首部增加对CMake的最低版本要求：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimun_required (VERSION <span class="number">2.6</span>)</span><br><span class="line">`</span><br></pre></td></tr></table></figure>
<p>1. 定义工程名：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">project</span> (MyProject [CXX] [C] [JAVA]) <span class="comment"># 默认支持以上所有语言</span></span><br></pre></td></tr></table></figure>
<p>定义工程名通常是项目的顶级目录下的CMakeLists.txt的第一条命令。对于每一个<code>project</code>命令，CMake会创建一个对应的顶层IDE工程文件，其包含了该CMakeLists种定义的所有Target以及该文件中所有使用<code>add_subdirectory</code>指定的子目录中定义的Target。</p>
<p>2. 加入子目录：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_subdirectory</span>(SOURCE_DIR [BINARY_DIR] [EXCLUDE_FROM_ALL])</span><br></pre></td></tr></table></figure>
<p>生成子目录下的模块或程序并放在build的相应子目录下，如果指定了EXCLUDE_FROM_ALL选项，那么该目录下生成的工程将不会出现在顶层的Makefile或工程文件里。这对于将很多sample作为子项目的工程来说是很有意义的。</p>
<p>3. 设置变量：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> (VARIABLE_NAME value1 [value2 ...])</span><br></pre></td></tr></table></figure>
<p>这里定义的变量是一个由空格分隔的参数列表。set的变量会在当前文件以及add_subdirectory所有子目录下的CMakeLists中生效。但是任何子域下set的变量不会影响父域。</p>
<p>4. 输出提示信息：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">message</span> ([SEND_ERROR | STATUS | FATAL_ERROR] <span class="string">"message"</span>)</span><br></pre></td></tr></table></figure>
<p>5. 定义可执行对象target：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_executable</span> (MyExe <span class="envvar">$&#123;SRC_FILES&#125;</span>)</span><br></pre></td></tr></table></figure>
<p>6. 定义静态库、动态库target：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_library</span> (MyLib [SHARED | STATIC | MODULE] <span class="string">"$&#123;SRC_FILES&#125;"</span>)</span><br></pre></td></tr></table></figure>
<p>7. 增加INCLUDE目录：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include_directories</span> (<span class="string">"$&#123;PROJECT_BINARY_DIR&#125;"</span>)</span><br></pre></td></tr></table></figure>
<p>8. 增加link的库目录：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">link_directories</span> (<span class="string">"$&#123;PROJECT_BINARY_DIR&#125;"</span>)</span><br></pre></td></tr></table></figure>
<p>9. 为target增加链接对象:</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">target_link_libraries</span> (MyExe <span class="string">"$&#123;LIB_NAMES&#125;"</span>)</span><br></pre></td></tr></table></figure>
<p>10. 增加项目依赖：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_dependencies</span> (target-name depend-target1 depend-target2)</span><br></pre></td></tr></table></figure>
<p>定义target依赖其他target，保证在编译本target之前，其他target已经被构建。</p>
<h4 id="u5185_u7F6E_u53D8_u91CF"><a href="#u5185_u7F6E_u53D8_u91CF" class="headerlink" title="内置变量"></a>内置变量</h4><p>CMAKE提供了一些内置变量，通过读取或设置这些变量的值可以控制编译：</p>
<p>1. 指定二进制目标的保存位置：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 指定编译的可执行文件输出到项目build目录下的bin文件夹</span></span><br><span class="line"><span class="keyword">set</span> (EXECUTABLE_OUTPUT_PATH <span class="envvar">$&#123;PROJECT_BINARY_DIR&#125;</span>/bin)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定编译的库文件输出到项目build目录下的lib文件夹</span></span><br><span class="line"><span class="keyword">set</span> (LIBRARY_OUTPUT_PATH <span class="envvar">$&#123;PROJECT_BINARY_DIR&#125;</span>/lib)</span><br></pre></td></tr></table></figure>
<p>无论是否在ADD_SUBDIRECTORY中制定了编译输出目录，都可以指定最终二进制的位置。</p>
<p>2. CMake中系统信息的内置变量：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">CMAKE_SYSTEM		<span class="comment"># 系统名称，比如Linux-2.6.22</span></span><br><span class="line"></span><br><span class="line">CMAKE_SYSTEM_NAME	<span class="comment"># 不包含版本的系统名，比如Linux</span></span><br><span class="line"></span><br><span class="line">APPLE				<span class="comment"># Mac OS X上返回TRUE</span></span><br><span class="line"></span><br><span class="line">UNIX				<span class="comment"># 所有的类UNIX平台上为TRUE，包括OS X和cygwin</span></span><br><span class="line"></span><br><span class="line">WIN32				<span class="comment"># 所有win32平台上为TRUE，包括cygwin</span></span><br><span class="line"></span><br><span class="line">CYGWIN				<span class="comment"># cygwin下返回TRUE</span></span><br><span class="line"></span><br><span class="line">MSVC				<span class="comment"># 使用 Microsoft Visual C 时返回TRUE</span></span><br></pre></td></tr></table></figure>
<p>3. 其他常用变量</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CMAKE_BINARY_DIR &amp; PROJECT_BINARY_DIR	<span class="comment"># 执行cmake的目录。</span></span><br><span class="line"></span><br><span class="line">CMAKE_SOURCE_DIR $ PROJECT_SOURCE_DIR	<span class="comment"># 工程顶层目录</span></span><br><span class="line"></span><br><span class="line">CMAKE_CURRENT_SOURCE_DIR				<span class="comment"># 当前处理的CMakeLists.txt的所在路径</span></span><br><span class="line"></span><br><span class="line">CMAKE_CURRENT_BINARY_DIR				<span class="comment"># 当前处理的CMakeLists.txt的输出路径</span></span><br></pre></td></tr></table></figure>
<h4 id="u6D41_u7A0B_u63A7_u5236"><a href="#u6D41_u7A0B_u63A7_u5236" class="headerlink" title="流程控制"></a>流程控制</h4><p>CMake提供了三种流程控制命令：</p>
<p>1. 条件指令（if）</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (FOO)</span><br><span class="line">	<span class="comment"># do something</span></span><br><span class="line"><span class="keyword">else</span> ()</span><br><span class="line">	<span class="comment"># do something</span></span><br><span class="line"><span class="keyword">endif</span> ()</span><br></pre></td></tr></table></figure>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (MSVC80)</span><br><span class="line">	<span class="comment"># do something</span></span><br><span class="line"><span class="keyword">elseif</span> (MSVC90)</span><br><span class="line">	<span class="comment"># do something</span></span><br><span class="line"><span class="keyword">elseif</span> (APPLE)</span><br><span class="line">	<span class="comment"># do something</span></span><br><span class="line"><span class="keyword">endif</span> ()</span><br></pre></td></tr></table></figure>
<p>其中<code>if</code>可支持的形式有：<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (variable)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (NOT variable)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (variable1 <span class="keyword">AND</span> variable2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (variable1 <span class="keyword">OR</span> variable2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (EXISTS file-name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (EXISTS directory-name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (IS_DIRECTORY name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (IS_ABSOLUTE name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (name1 IS_NEWER_THAN name2)</span><br><span class="line"></span><br><span class="line"><span class="operator">EQUAL</span>, <span class="operator">LESS</span>, <span class="operator">GREATER</span> <span class="comment"># 数值比较</span></span><br><span class="line"><span class="operator">STRLESS</span>, <span class="operator">STREQUAL</span>, STRGEATER <span class="comment"># ZIFUCHUAN BIJIAO</span></span><br></pre></td></tr></table></figure></p>
<p>2. 循环结构（foreach &amp; while）</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span> (tfile</span><br><span class="line">		file1</span><br><span class="line">		file2</span><br><span class="line">		file3)</span><br><span class="line">	<span class="comment"># do something with tfile</span></span><br><span class="line"><span class="keyword">endforeach</span> (tfile)</span><br></pre></td></tr></table></figure>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="envvar">$&#123;var&#125;</span> <span class="operator">LESS</span> <span class="number">3600</span>)</span><br><span class="line">	<span class="comment"># do something</span></span><br><span class="line"><span class="keyword">endwhile</span> ()</span><br></pre></td></tr></table></figure>
<p>3. 过程定义 (macro &amp; function)</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> (FunctionName param)</span><br><span class="line">	<span class="comment"># do something with $&#123;param&#125;</span></span><br><span class="line"><span class="keyword">endfunction</span>()</span><br><span class="line"></span><br><span class="line">FunctionName(<span class="number">123</span>)</span><br></pre></td></tr></table></figure>
<p>macro和function的使用方法一样，但是macro不涉及变量作用于的变化。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">macro</span> (assert TEST COMMENT)</span><br><span class="line">	<span class="comment"># do something</span></span><br><span class="line"><span class="keyword">endmacro</span> (assert)</span><br><span class="line"></span><br><span class="line">FunctionName(<span class="number">123</span>)</span><br></pre></td></tr></table></figure>
<h3 id="u4F7F_u7528Modules"><a href="#u4F7F_u7528Modules" class="headerlink" title="使用Modules"></a>使用Modules</h3><p>Module就是放在一个单独文件中的一段CMake命令。可以通过<code>include</code>命令来使用：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span> (FindTCL)</span><br><span class="line"></span><br><span class="line">target_link_library (FOO <span class="envvar">$&#123;TCL_LIBRARY&#125;</span>)</span><br></pre></td></tr></table></figure>
<p>CMake内置了大量的Module，可以很方便的定位已安装的库或头文件或查看系统属性。具体的Module项目以及用法可以查看cmake安装目录下的Module目录。</p>
<p>Find<xx>.cmake模块通常的规则是：</xx></p>
<pre><code>&lt;XX&gt;_INCLUDE_DIRS: 头文件目录

&lt;XX&gt;_LIBRARIES: LINK目录

&lt;XX&gt;_DEFINITIONS: 编译该库需要使用的预处理define

&lt;XX&gt;_FOUND: 是否找到
</code></pre><h3 id="u901A_u8FC7find_path_uFF0Cfind_library_u547D_u4EE4_u81EA_u5DF1_u6307_u5B9A_u76EE_u5F55_u8FDB_u884C_u641C_u7D22"><a href="#u901A_u8FC7find_path_uFF0Cfind_library_u547D_u4EE4_u81EA_u5DF1_u6307_u5B9A_u76EE_u5F55_u8FDB_u884C_u641C_u7D22" class="headerlink" title="通过find_path，find_library命令自己指定目录进行搜索"></a>通过<code>find_path</code>，<code>find_library</code>命令自己指定目录进行搜索</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_library</span> (TIFF_LIBRARY</span><br><span class="line">			  NAMES tiff tiff2</span><br><span class="line">			  PATHS /usr/local/lib /usr/lib)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">find_path</span> (TIFF_INCLUDES tiff.h</span><br><span class="line">		   /usr/local/<span class="keyword">include</span></span><br><span class="line">		   /usr/<span class="keyword">include</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">include_directories</span> (<span class="envvar">$&#123;TIFF_INCLUDES&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_executable</span> (mytiff mytiff.c)</span><br><span class="line"></span><br><span class="line"><span class="keyword">target_link_libraries</span> (mytiff <span class="envvar">$&#123;TIFF_LIBRARY&#125;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="u4E3A_u7F16_u8BD1_u5668_u4F20_u9012_u7F16_u8BD1_u9009_u9879"><a href="#u4E3A_u7F16_u8BD1_u5668_u4F20_u9012_u7F16_u8BD1_u9009_u9879" class="headerlink" title="为编译器传递编译选项"></a>为编译器传递编译选项</h3><p>1. 使用<code>add_definitions</code>为编译器增加预处理define：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">option</span> (DEBUG_BUILD <span class="string">"Build with extra debug message"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (DEBUG_BUILD)</span><br><span class="line">	<span class="keyword">add_definitions</span> (-DDEBUG_BUILD)</span><br><span class="line"><span class="keyword">endif</span> ()</span><br></pre></td></tr></table></figure>
<p>2. 为单个的目录，target，或源代码指定编译选项：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set_property</span> (</span><br><span class="line">	DIRECTORY	<span class="comment"># 当前目录及子目录</span></span><br><span class="line">	PROPERTY COMPILE_DEFINITIONS A AV=<span class="number">1</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set_property</span> (</span><br><span class="line">	TARGET mylib</span><br><span class="line">	PROPERTY COMPILE_DEFINITONS B BV=<span class="number">2</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set_property</span> (</span><br><span class="line">	SOURCE src1.c</span><br><span class="line">	PROPERTY COMPILE_DEFINITIONS C CV=<span class="number">3</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="u6587_u4EF6_u64CD_u4F5C"><a href="#u6587_u4EF6_u64CD_u4F5C" class="headerlink" title="文件操作"></a>文件操作</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">file (WRITE filename <span class="string">"message to write"</span>)</span><br><span class="line"></span><br><span class="line">file (APPEND filename <span class="string">"message to write"</span>)</span><br><span class="line"></span><br><span class="line">file (READ filename variable)</span><br><span class="line"></span><br><span class="line">file (GLOB variable [RELATIVE PATH] [GLOBBING EXPRESSIONS])</span><br><span class="line"></span><br><span class="line">file (GLOB_RECURSE variable [RELATIVE PATH] [GLOBBING EXPRESSIONS])</span><br><span class="line"></span><br><span class="line">file (<span class="keyword">REMOVE</span> [DIRECTORY])</span><br><span class="line"></span><br><span class="line">file (REMOVE_RECURSE [DIRECTORY])</span><br><span class="line"></span><br><span class="line">file (<span class="keyword">MAKE_DIRECTORY</span> [DIRECTORY])</span><br></pre></td></tr></table></figure>
<h3 id="u5176_u4ED6"><a href="#u5176_u4ED6" class="headerlink" title="其他"></a>其他</h3><p>至此，CMAKE的基本用法基本阐述完毕。然而，这次重新捡起CMake的主要目的还是在于希望用CMake进行cocos2d-x的跨平台构建。这就涉及到如何使用CMake进行交叉编译。这部分内容我会在下一篇博文中进行阐述。</p>
</div><div class="tags"><a href="/tags/CMake/">CMake</a><a href="/tags/Tools/">Tools</a></div><div class="post-nav"><a href="/2013/12/12/python-meta-programming/" class="pre"><i class="icon-previous">Python Meta-programming</i></a><a href="/2013/12/07/notes-on-protected-mode/" class="next">Notes on Protected Mode<i class="icon-next"></i></a></div><div id="disqus_thread"><script>var disqus_shortname = 'nightfade';
var disqus_identifier = '2013/12/07/building-cross-platform-project-using-cmake/';
var disqus_title = 'Building Cross-platform Project Using CMake';
var disqus_url = 'http://nightfade.github.io/2013/12/07/building-cross-platform-project-using-cmake/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//nightfade.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search" class="search-form-input"/><input type="hidden" name="sitesearch" value="http://nightfade.github.io"/></form></div><div class="widget"><div class="widget-title">分类</div></div><div class="widget"><div class="widget-title">标签</div><div class="tagcloud"><a href="/tags/HLS/" style="font-size: 15px;">HLS</a> <a href="/tags/Tools/" style="font-size: 15px;">Tools</a> <a href="/tags/CPP/" style="font-size: 15px;">CPP</a> <a href="/tags/Multithreading/" style="font-size: 15px;">Multithreading</a> <a href="/tags/iOS/" style="font-size: 15px;">iOS</a> <a href="/tags/ReactiveCocoa/" style="font-size: 15px;">ReactiveCocoa</a> <a href="/tags/Swift/" style="font-size: 15px;">Swift</a> <a href="/tags/database/" style="font-size: 15px;">database</a> <a href="/tags/SQLite/" style="font-size: 15px;">SQLite</a> <a href="/tags/CMake/" style="font-size: 15px;">CMake</a> <a href="/tags/qiniu/" style="font-size: 15px;">qiniu</a> <a href="/tags/node/" style="font-size: 15px;">node</a> <a href="/tags/GameDev/" style="font-size: 15px;">GameDev</a> <a href="/tags/Actor/" style="font-size: 15px;">Actor</a> <a href="/tags/protobuf/" style="font-size: 15px;">protobuf</a> <a href="/tags/RPC/" style="font-size: 15px;">RPC</a> <a href="/tags/Network/" style="font-size: 15px;">Network</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/Operating-System/" style="font-size: 15px;">Operating System</a></div></div><div class="widget"><div class="widget-title">最新文章</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2015/09/15/cpp1x-atomic/">多线程内存模型和C++1x Atomic</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/09/01/reactivecocoa3-basic/">ReactiveCocoa 3.0 初步</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/28/notes-on-using-swift-with-cocoa-and-objective-c/">《Using Swift with Cocoa and Objective-C》学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/12/ios-promise/">iOS开发中的Promise模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/09/ios-in-app-purchase/">iOS应用内购买IAP接入</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/02/sql-summary/">SQLite中的常用SQL语法、锁机制和WAL</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/06/26/ios-markdown-rendering/">iOS开发中的Markdown渲染</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/06/24/dynamic-height-cell/">可变高度的UITableViewCell</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/05/10/qiniu-hls/">使用七牛云存储实现HLS在线视频授权播放</a></li><li class="post-list-item"><a class="post-list-link" href="/2013/12/20/actor-model-and-game-development/">关于Actor模型与游戏编程的一点想法</a></li></ul></div><div class="widget"><div class="widget-title">最近评论</div><script type="text/javascript" src="//nightfade.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title">友情链接</div></div></div></div></div><div id="footer">© <a href="/." rel="nofollow">Nightfade's Techlog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div><a id="rocket" href="#top" class="show"></a><script src="/js/jquery.min.js" type="text/javascript"></script>
<script src="/js/totop.js" type="text/javascript"></script><script src="/js/fancybox.pack.js" type="text/javascript"></script>
<script src="/js/jquery.fancybox.js" type="text/javascript"></script><link rel="stylesheet" href="/css/jquery.fancybox.css" type="text/css"></div></body></html>